//
//  MarketDataModel.swift
//  SwiftfulCripto
//
//  Created by jeong jinho on 2022/09/26.
//

import Foundation

// JSON data:
/*
 JSON:
 {
   "data": {
     "active_cryptocurrencies": 12930,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 577,
     "total_market_cap": {
       "btc": 50979698.76360086,
       "eth": 741269160.568512,
       "ltc": 18176597137.101715,
       "bch": 8380567645.522302,
       "bnb": 3532474645.8845997,
       "eos": 830786366288.8297,
       "xrp": 2074589715301.0579,
       "xlm": 8499977163600.572,
       "link": 126914867649.68883,
       "dot": 150118099918.52786,
       "yfi": 117827670.25521013,
       "usd": 961670725629.4116,
       "aed": 3532259850419.486,
       "ars": 139744554485525.11,
       "aud": 1482080762145.222,
       "bdt": 96952916221449.9,
       "bhd": 362618142183.80804,
       "bmd": 961670725629.4116,
       "brl": 5060984527769.905,
       "cad": 1316927278408.5276,
       "chf": 953188789829.358,
       "clp": 948534303517315.8,
       "cny": 6886524066232.21,
       "czk": 24558723856004.637,
       "dkk": 7413469616999.401,
       "eur": 996908264357.9257,
       "gbp": 891929402936.0417,
       "hkd": 7549067112654.602,
       "huf": 407653010125973.25,
       "idr": 14572610760514284,
       "ils": 3397106646639.527,
       "inr": 78477471341388.33,
       "jpy": 138664648267520.83,
       "krw": 1374723459179550.2,
       "kwd": 298700697404.8492,
       "lkr": 348423003306474.6,
       "mmk": 2018453680666214,
       "mxn": 19553197917311.04,
       "myr": 4426570350072.183,
       "ngn": 418831827420528.75,
       "nok": 10334101115894.248,
       "nzd": 1684368199281.3682,
       "php": 56731362205034.28,
       "pkr": 226354902080341.8,
       "pln": 4749994640162.239,
       "rub": 55608608747850.07,
       "sar": 3617132100309.9043,
       "sek": 10897130475628.453,
       "sgd": 1380105198399.4758,
       "thb": 36412700355232.05,
       "try": 17746455194851.9,
       "twd": 30621037448458.168,
       "uah": 35324270849586.72,
       "vef": 96292089757.27287,
       "vnd": 22815443467653540,
       "zar": 17372610508617.078,
       "xdr": 684496065747.0509,
       "xag": 51413869321.27619,
       "xau": 586128690.5638689,
       "bits": 50979698763600.87,
       "sats": 5097969876360086
     },
     "total_volume": {
       "btc": 11007059.020064918,
       "eth": 160047893.5343807,
       "ltc": 3924520590.044576,
       "bch": 1809453663.578197,
       "bnb": 762698836.1472291,
       "eos": 179375610068.052,
       "xrp": 447925978233.56573,
       "xlm": 1835235448188.966,
       "link": 27402269386.128105,
       "dot": 32412093948.326954,
       "yfi": 25440246.84629656,
       "usd": 207634934917.06003,
       "aed": 762652459522.4335,
       "ars": 30172335189495.07,
       "aud": 319996995217.2975,
       "bdt": 20933165493297.453,
       "bhd": 78293112544.11078,
       "bmd": 207634934917.06003,
       "brl": 1092720371988.012,
       "cad": 284338602034.3809,
       "chf": 205803594791.09106,
       "clp": 204798641706093.38,
       "cny": 1486873768941.0652,
       "czk": 5302489608540.516,
       "dkk": 1600646916259,
       "eur": 215243094202.29117,
       "gbp": 192577041801.94006,
       "hkd": 1629923857352.1758,
       "huf": 88016619379623.28,
       "idr": 3146381610868587.5,
       "ils": 733471445769.1896,
       "inr": 16944120497959.197,
       "jpy": 29939171954599.785,
       "krw": 296817411998146.44,
       "kwd": 64492656594.84838,
       "lkr": 75228231126404.44,
       "mmk": 435805611472605.06,
       "mxn": 4221743335614.232,
       "myr": 955743605423.2275,
       "ngn": 90430244895660.05,
       "nok": 2231242311364.578,
       "nzd": 363673003777.101,
       "php": 12248904313364.482,
       "pkr": 48872430145826.05,
       "pln": 1025574348559.8588,
       "rub": 12006489903944.076,
       "sar": 780977280703.5375,
       "sek": 2352806336710.4595,
       "sgd": 297979386718.6918,
       "thb": 7861889175699.5625,
       "try": 3831648371099.0703,
       "twd": 6611407572526.628,
       "uah": 7626885672376.153,
       "vef": 20790486033.245197,
       "vnd": 4926096836741664,
       "zar": 3750931328324.734,
       "xdr": 147789978705.39505,
       "xag": 11100801059.91626,
       "xau": 126551416.48259865,
       "bits": 11007059020064.918,
       "sats": 1100705902006491.9
     },
     "market_cap_percentage": {
       "btc": 37.58579891844116,
       "eth": 16.276998583767792,
       "usdt": 7.07021203290541,
       "usdc": 5.13498034176446,
       "bnb": 4.621336502605088,
       "xrp": 2.402823134850949,
       "busd": 2.188311272383834,
       "ada": 1.5483913834538958,
       "sol": 1.1957548812701937,
       "doge": 0.8342298520373616
     },
     "market_cap_change_percentage_24h_usd": -1.6620755521991466,
     "updated_at": 1664194966
   }
 }
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}


struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]?
    let marketCapChangePercentage24HUsd: Double?
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    
    var marketCap: String {
        
        if let item = totalMarketCap?.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbrevations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume?.first(where: { $0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbrevations()
        }
        return ""
    }
    
    var btcDominence: String {
        if let item = marketCapPercentage?.first(where: {$0.key == "btc"}) {
            return "\(item.value.asPercentString())"
        }
        return ""
    }
    

}
